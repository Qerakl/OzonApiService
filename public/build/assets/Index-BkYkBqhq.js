import{d as F,r as a,a as s,o,e as b,u as M,m as U,w as B,b as e,f as u,i as p,j as k,k as w,t as d,F as x,g as _,l as N,v as h,p as T}from"./app-LKHBisej.js";import{_ as j}from"./AppLayout.vue_vue_type_script_setup_true_lang-DCt4ybde.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Do0EwquQ.js";import"./useForwardExpose-lrOOhfFU.js";import"./RovingFocusGroup-C5gLdjUy.js";const I={class:"p-6 max-w-4xl mx-auto bg-white rounded-lg shadow-md space-y-8"},z={class:"space-y-3"},E={class:"flex gap-6"},H={class:"cursor-pointer flex items-center gap-2"},L={class:"cursor-pointer flex items-center gap-2"},R={key:0,class:"space-y-3"},$={key:0,class:"text-sm text-gray-600 mt-1"},q={key:1,class:"space-y-3"},A=["value"],G={key:2,class:"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-md"},J=["disabled"],K={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},O={class:"min-w-full border-collapse border border-gray-300 mt-8"},P={key:0},Q={class:"border border-gray-300 px-4 py-2"},W={class:"border border-gray-300 px-4 py-2"},X={class:"border border-gray-300 px-4 py-2 text-right"},Y={class:"border border-gray-300 px-4 py-2 text-right"},Z={class:"border border-gray-300 px-4 py-2"},re=F({__name:"Index",props:{marketplaces:{},forecasts:{}},setup(V){const m=V,C=[{title:"Прогнозы",href:"/forecasts"}],S=a(m.marketplaces),v=a(m.forecasts);a(""),a(1);const r=a(null),c=a(null),g=a(null),i=a(!1),f=a(""),y=a("");async function D(){i.value=!0;try{const n=new FormData;if(n.append("data_source",r.value||""),r.value==="csv"){if(!c.value){alert("Выберите CSV-файл"),i.value=!1;return}n.append("csv_file",c.value)}if(r.value==="marketplace"){if(!g.value||!f.value||!y.value){alert("Заполните все поля"),i.value=!1;return}n.append("marketplace_id",g.value.toString()),n.append("delivery_date_from",f.value),n.append("delivery_date_to",y.value)}const t=await T.post("/marketplace/forecasts/calculate",n,{headers:{"Content-Type":"multipart/form-data"}});console.log("Ответ от сервера:",t.data),v.value=t.data.forecasts??[]}catch(n){console.error("Ошибка:",n),alert("Ошибка при отправке данных на сервер")}finally{i.value=!1}}return(n,t)=>(o(),s(x,null,[b(M(U),{title:"Прогнозы по площадкам"}),b(j,{breadcrumbs:C},{default:B(()=>[e("div",I,[e("section",z,[t[8]||(t[8]=e("h2",{class:"text-xl font-semibold text-gray-800"},"1. Выберите источник данных",-1)),e("div",E,[e("label",H,[p(e("input",{type:"radio",value:"csv","onUpdate:modelValue":t[0]||(t[0]=l=>r.value=l),class:"accent-indigo-600"},null,512),[[k,r.value]]),t[6]||(t[6]=e("span",null,"Загрузить CSV-файл",-1))]),e("label",L,[p(e("input",{type:"radio",value:"marketplace","onUpdate:modelValue":t[1]||(t[1]=l=>r.value=l),class:"accent-indigo-600"},null,512),[[k,r.value]]),t[7]||(t[7]=e("span",null,"Выбрать площадку из маркетплейсов",-1))])])]),r.value==="csv"?(o(),s("section",R,[t[10]||(t[10]=e("h2",{class:"text-xl font-semibold text-gray-800"},"2. Загрузите CSV-файл",-1)),e("input",{type:"file",accept:".csv,text/csv",onChange:t[2]||(t[2]=l=>c.value=l.target.files?l.target.files[0]:null),class:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"},null,32),c.value?(o(),s("p",$,[t[9]||(t[9]=w("Выбран файл: ")),e("strong",null,d(c.value.name),1)])):u("",!0)])):u("",!0),r.value==="marketplace"?(o(),s("section",q,[t[12]||(t[12]=e("h2",{class:"text-xl font-semibold text-gray-800"},"2. Выберите площадку",-1)),p(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>g.value=l),class:"w-full border border-gray-300 rounded px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},[t[11]||(t[11]=e("option",{value:"",disabled:""},"Выберите площадку",-1)),(o(!0),s(x,null,_(S.value,l=>(o(),s("option",{key:l.id,value:l.id},d(l.name)+" ("+d(l.client_id||"—")+") ",9,A))),128))],512),[[N,g.value]])])):u("",!0),r.value==="marketplace"?(o(),s("section",G,[e("div",null,[t[13]||(t[13]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Дата от",-1)),p(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=l=>f.value=l),class:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[h,f.value]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Дата до",-1)),p(e("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=l=>y.value=l),class:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[h,y.value]])])])):u("",!0),e("div",null,[e("button",{onClick:D,disabled:i.value,class:"inline-flex items-center justify-center bg-indigo-600 text-white px-6 py-3 rounded-md font-semibold hover:bg-indigo-700 disabled:bg-indigo-400 disabled:cursor-not-allowed transition-colors duration-200 ease-in-out"},[i.value?(o(),s("svg",K,t[15]||(t[15]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"},null,-1)]))):u("",!0),w(" "+d(i.value?"Рассчитываем...":"Рассчитать"),1)],8,J)]),e("table",O,[t[17]||(t[17]=e("thead",null,[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-300 px-4 py-2 text-left text-gray-700"},"Артикул"),e("th",{class:"border border-gray-300 px-4 py-2 text-left text-gray-700"},"Название"),e("th",{class:"border border-gray-300 px-4 py-2 text-right text-gray-700"},"Текущий остаток"),e("th",{class:"border border-gray-300 px-4 py-2 text-right text-gray-700"},"Прогноз"),e("th",{class:"border border-gray-300 px-4 py-2 text-left text-gray-700"},"Рекомендации")])],-1)),e("tbody",null,[v.value.length===0?(o(),s("tr",P,t[16]||(t[16]=[e("td",{colspan:"5",class:"text-center py-6 text-gray-500"},"Нет данных для отображения",-1)]))):u("",!0),(o(!0),s(x,null,_(v.value,l=>(o(),s("tr",{key:l.id,class:"hover:bg-gray-100 transition-colors"},[e("td",Q,d(l.article),1),e("td",W,d(l.name),1),e("td",X,d(l.current_stock),1),e("td",Y,d(l.forecast),1),e("td",Z,d(l.recommendations),1)]))),128))])])])]),_:1})],64))}});export{re as default};
