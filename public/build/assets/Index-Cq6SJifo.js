import{d as F,r as n,a as o,o as r,e as x,u as M,m as U,w as B,b as e,f as d,i as g,j as k,k as w,t as a,F as v,g as _,l as N,v as h,p as T}from"./app-Cxu8vNAA.js";import{_ as j}from"./AppLayout.vue_vue_type_script_setup_true_lang-CBPaIuhl.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Dhf8yyQR.js";import"./useForwardExpose-vok6YTmq.js";import"./RovingFocusGroup-DZWEkFVA.js";const I={class:"p-6 max-w-4xl mx-auto bg-white rounded-lg shadow-md space-y-8"},z={class:"space-y-3"},E={class:"flex gap-6"},H={class:"cursor-pointer flex items-center gap-2"},L={class:"cursor-pointer flex items-center gap-2"},R={key:0,class:"space-y-3"},$={key:0,class:"text-sm text-gray-600 mt-1"},q={key:1,class:"space-y-3"},A=["value"],G={key:2,class:"grid grid-cols-1 md:grid-cols-2 gap-6 max-w-md"},J=["disabled"],K={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},O={class:"min-w-full border-collapse border border-gray-300 mt-8"},P={key:0},Q={class:"border border-gray-300 px-4 py-2"},W={class:"border border-gray-300 px-4 py-2"},X={class:"border border-gray-300 px-4 py-2 text-right"},Y={class:"border border-gray-300 px-4 py-2 text-right"},Z={class:"border border-gray-300 px-4 py-2"},re=F({__name:"Index",props:{marketplaces:{},forecasts:{}},setup(V){const b=V,C=[{title:"Прогнозы",href:"/forecasts"}],S=n(b.marketplaces),m=n(b.forecasts),u=n(""),f=n(1),s=n(null),c=n(null),y=n(null),p=n(!1);async function D(){if(!s.value){alert("Выберите источник данных");return}const i=new FormData;if(i.append("data_source",s.value),u.value&&i.append("delivery_date",u.value),f.value&&i.append("stock_days",f.value.toString()),s.value==="csv"){if(!c.value){alert("Загрузите CSV-файл");return}i.append("csv_file",c.value)}if(s.value==="marketplace"){if(!y.value){alert("Выберите площадку");return}if(!u.value){alert("Введите дату поставки");return}i.append("marketplace_id",y.value.toString())}p.value=!0;try{const t=await T.post("/marketplace/forecasts/calculate",i,{headers:{"Content-Type":"multipart/form-data"}});window.location.reload()}catch(t){console.error("Ошибка при расчёте прогноза:",t),alert("Произошла ошибка при отправке формы")}finally{p.value=!1}}return(i,t)=>(r(),o(v,null,[x(M(U),{title:"Прогнозы по площадкам"}),x(j,{breadcrumbs:C},{default:B(()=>[e("div",I,[e("section",z,[t[8]||(t[8]=e("h2",{class:"text-xl font-semibold text-gray-800"},"1. Выберите источник данных",-1)),e("div",E,[e("label",H,[g(e("input",{type:"radio",value:"csv","onUpdate:modelValue":t[0]||(t[0]=l=>s.value=l),class:"accent-indigo-600"},null,512),[[k,s.value]]),t[6]||(t[6]=e("span",null,"Загрузить CSV-файл",-1))]),e("label",L,[g(e("input",{type:"radio",value:"marketplace","onUpdate:modelValue":t[1]||(t[1]=l=>s.value=l),class:"accent-indigo-600"},null,512),[[k,s.value]]),t[7]||(t[7]=e("span",null,"Выбрать площадку из маркетплейсов",-1))])])]),s.value==="csv"?(r(),o("section",R,[t[10]||(t[10]=e("h2",{class:"text-xl font-semibold text-gray-800"},"2. Загрузите CSV-файл",-1)),e("input",{type:"file",accept:".csv,text/csv",onChange:t[2]||(t[2]=l=>c.value=l.target.files?l.target.files[0]:null),class:"block w-full text-sm text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"},null,32),c.value?(r(),o("p",$,[t[9]||(t[9]=w("Выбран файл: ")),e("strong",null,a(c.value.name),1)])):d("",!0)])):d("",!0),s.value==="marketplace"?(r(),o("section",q,[t[12]||(t[12]=e("h2",{class:"text-xl font-semibold text-gray-800"},"2. Выберите площадку",-1)),g(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>y.value=l),class:"w-full border border-gray-300 rounded px-3 py-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},[t[11]||(t[11]=e("option",{value:"",disabled:""},"Выберите площадку",-1)),(r(!0),o(v,null,_(S.value,l=>(r(),o("option",{key:l.id,value:l.id},a(l.name)+" ("+a(l.client_id||"—")+") ",9,A))),128))],512),[[N,y.value]])])):d("",!0),s.value==="marketplace"?(r(),o("section",G,[e("div",null,[t[13]||(t[13]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Дата поставки",-1)),g(e("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=l=>u.value=l),class:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[h,u.value]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block mb-1 font-medium text-gray-700"},"Дней загрузки склада",-1)),g(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=l=>f.value=l),min:"1",class:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[h,f.value,void 0,{number:!0}]])])])):d("",!0),e("div",null,[e("button",{onClick:D,disabled:p.value,class:"inline-flex items-center justify-center bg-indigo-600 text-white px-6 py-3 rounded-md font-semibold hover:bg-indigo-700 disabled:bg-indigo-400 disabled:cursor-not-allowed transition-colors duration-200 ease-in-out"},[p.value?(r(),o("svg",K,t[15]||(t[15]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8H4z"},null,-1)]))):d("",!0),w(" "+a(p.value?"Рассчитываем...":"Рассчитать"),1)],8,J)]),e("table",O,[t[17]||(t[17]=e("thead",null,[e("tr",{class:"bg-gray-50"},[e("th",{class:"border border-gray-300 px-4 py-2 text-left text-gray-700"},"Артикул"),e("th",{class:"border border-gray-300 px-4 py-2 text-left text-gray-700"},"Название"),e("th",{class:"border border-gray-300 px-4 py-2 text-right text-gray-700"},"Текущий остаток"),e("th",{class:"border border-gray-300 px-4 py-2 text-right text-gray-700"},"Прогноз"),e("th",{class:"border border-gray-300 px-4 py-2 text-left text-gray-700"},"Рекомендации")])],-1)),e("tbody",null,[m.value.length===0?(r(),o("tr",P,t[16]||(t[16]=[e("td",{colspan:"5",class:"text-center py-6 text-gray-500"},"Нет данных для отображения",-1)]))):d("",!0),(r(!0),o(v,null,_(m.value,l=>(r(),o("tr",{key:l.id,class:"hover:bg-gray-100 transition-colors"},[e("td",Q,a(l.article),1),e("td",W,a(l.name),1),e("td",X,a(l.current_stock),1),e("td",Y,a(l.forecast),1),e("td",Z,a(l.recommendations),1)]))),128))])])])]),_:1})],64))}});export{re as default};
