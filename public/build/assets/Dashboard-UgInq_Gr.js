import{d as M,n as V,c as s,r as i,w as D,a as g,o as x,b as l,u as r,m as E,e as N,f as t,g as C,v as P,h as R,i as U,F as W,W as j}from"./app-Bzay_NOV.js";import{_ as q}from"./AppLayout.vue_vue_type_script_setup_true_lang-sjnllyIJ.js";import{C as A,p as O,a as T,b as $,L as z,B as G,c as H,d as I,P as J,e as m,f as K}from"./index-C4W8HvQg.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B3Ozja9l.js";import"./useForwardExpose-DviW8cfF.js";import"./RovingFocusGroup-BGDgKuKE.js";const Q={class:"p-6 space-y-6"},X={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},Y={class:"grid md:grid-cols-2 gap-6"},Z={class:"h-[400px] rounded-xl border p-4 shadow-sm"},ee={class:"h-[400px] rounded-xl border p-4 shadow-sm"},ae={class:"md:col-span-2 h-[400px] rounded-xl border p-4 shadow-sm"},te={class:"h-[400px] rounded-xl border p-4 shadow-sm"},se={class:"h-[400px] rounded-xl border p-4 shadow-sm"},oe={class:"text-center"},pe=M({__name:"Dashboard",setup(le){A.register(O,T,$,z,G,H,I,J);const c=V(),v=s(()=>c.props.forecasts),w=s(()=>c.props.hasMore);i(c.props.limit);const b=s(()=>c.props.pagination),h=i(""),u=i(20),o=s(()=>{const e=h.value.toLowerCase();return v.value.filter(a=>a.name.toLowerCase().includes(e)||a.article.toLowerCase().includes(e)).slice(0,u.value)}),_=i(!1),k=async()=>{var e;(e=b.value)!=null&&e.next_page_url&&(_.value=!0,await j.get(b.value.next_page_url,{},{preserveState:!0,preserveScroll:!0,only:["forecasts","pagination"],onSuccess:()=>{u.value+=b.value.per_page},onFinish:()=>{_.value=!1}}))},p=s(()=>o.value.map(e=>e.name.length>25?e.name.slice(0,25)+"…":e.name)),n=e=>({responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:e}},maintainAspectRatio:!1}),y=s(()=>({labels:p.value,datasets:[{label:"Остаток",data:o.value.map(e=>e.current_stock),backgroundColor:"#3b82f6"}]})),L=s(()=>({labels:p.value,datasets:[{label:"Прогноз",data:o.value.map(e=>e.forecast),backgroundColor:"#10b981"}]})),S=s(()=>({labels:p.value,datasets:[{label:"Остаток",data:o.value.map(e=>e.current_stock),borderColor:"#3b82f6",fill:!1,tension:.4},{label:"Прогноз",data:o.value.map(e=>e.forecast),borderColor:"#10b981",fill:!1,tension:.4}]})),B=s(()=>({labels:p.value,datasets:[{label:"Рекомендуемое пополнение",data:o.value.map(e=>e.forecast-e.current_stock),backgroundColor:"#f59e0b"}]})),F=s(()=>{const e=[...o.value].sort((a,d)=>a.current_stock-d.current_stock).slice(0,10);return{labels:e.map(a=>a.name.length>25?a.name.slice(0,25)+"…":a.name),datasets:[{label:"Топ 10 наименьших остатков",data:e.map(a=>a.current_stock),backgroundColor:"#ef4444"}]}}),f=i([...v.value]);return D(v,e=>{f.value=[...f.value,...e]}),(e,a)=>(x(),g(W,null,[l(r(E),{title:"Dashboard"}),l(q,{breadcrumbs:[{title:"Dashboard",href:"/dashboard"}]},{default:N(()=>[t("div",Q,[t("div",X,[C(t("input",{"onUpdate:modelValue":a[0]||(a[0]=d=>h.value=d),type:"text",placeholder:"Поиск по названию или артикулу",class:"w-full md:w-1/2 rounded-md border px-3 py-2"},null,512),[[P,h.value]]),C(t("select",{"onUpdate:modelValue":a[1]||(a[1]=d=>u.value=d),class:"rounded-md border px-3 py-2"},a[2]||(a[2]=[t("option",{value:10},"Показать 10",-1),t("option",{value:20},"Показать 20",-1),t("option",{value:50},"Показать 50",-1),t("option",{value:100},"Показать 100",-1),t("option",{value:9999},"Показать всё",-1)]),512),[[R,u.value]])]),t("div",Y,[t("div",Z,[l(r(m),{data:y.value,options:n("Остатки по товарам")},null,8,["data","options"])]),t("div",ee,[l(r(m),{data:L.value,options:n("Прогноз по товарам")},null,8,["data","options"])]),t("div",ae,[l(r(K),{data:S.value,options:n("Остаток против прогноза")},null,8,["data","options"])]),t("div",te,[l(r(m),{data:B.value,options:n("Рекомендуемое пополнение")},null,8,["data","options"])]),t("div",se,[l(r(m),{data:F.value,options:n("Топ 10 наименьших остатков")},null,8,["data","options"])])]),t("div",oe,[w.value?(x(),g("button",{key:0,onClick:k,class:"mt-6 rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 transition"}," Загрузить больше данных ")):U("",!0)])])]),_:1})],64))}});export{pe as default};
